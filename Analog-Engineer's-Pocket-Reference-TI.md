# 1. TI-模拟工程师口袋书
欢迎大家上TI的官网上，下载《模拟工程师口袋书》这本书。很薄，但是里面只有一堆的公式和结论，可以帮助大家回忆，但是不适合初学者。
## 1.1. 电容分类：
- 1类：COG。温漂和压电系数都很小。但是容量很小。低失真和滤波器
	- 电容的压电系数会引起失真，导致THD变差
- 2类：X7R。陶瓷电容，去耦合
	- X7R的每一位都对应着一个参数
	- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598261683_20200824161147240_1418203256.png )
- 3类：电解电容。容量大，ESR大，有极性



## 1.2. RMS和mean
mean很多时候没有具体的物理意义，RMS是有物理意义的。
因为我们最终关注的是功率，电功率，噪声功率。
电压和电流只有平方后才是功率。所以要先平方，然后再定积分，除以平均值，开根号，最终就是RMS，代表的是有效的平均功率。
公式：![](https://gitee.com/AndrewChu/markdown/raw/master/1598261684_20200824161226279_821125539.png)

常用RMS：
- sinx：0.707
- 量化噪声的三角波：1/sqrt(12)


# 2. 运放
详细的见：新概念模拟电路，或者TI-高精度实验室。这个手册没有详细展开。

稳定性分析：
- 一个极点增加20db/dec的下降，相位变为-90
- 一个零点增加20db/dec的上升，相位变为+90
- 稳定性：
	- 幅频=0，相频离-180度要有45度以上的裕度
	- 相频=-180，幅频要在-3db以下
## 2.1. 误差分析：
主要包含以下三方面：
- Vos
	- 会有温漂
- Ib
	- 会有温漂
- Ios
这三方面都最终会导致为输出的Vos，所以也可以吧电流导致的Vos等效为Vos加到+端方便计算


## 2.2. 环路增益测量
环路增益和闭环增益是不一样的，考不考虑M的问题。
环路增益可以自己再Aol图上画，也可以从LTspice仿真。
- 开环增益 Aol
- 环路增益是Aol*ß
- 闭环增益是M/(1+F*Aol)=M/F
- ß是反馈系数，是闭环增益的倒数.ß=F=1/Auf
- 用MF法就很容易分析，为什么ß是噪声增益。
- 稳定性分析：
	- 不稳定的时候：1+ßAol=0，所以Aol=1/ß,相位相差180度
	- 所以我们分析Aol*ß曲线就行，和0db的交点

LTspice分析：![](https://gitee.com/AndrewChu/markdown/raw/master/1598261667_20200819152817727_898154261.png  )

多反馈的开环增益：要把输入电容，加回去，因为被电感隔离了
图：![](https://gitee.com/AndrewChu/markdown/raw/master/1598261666_20200819151549207_1368887396.png  )

## 2.3. 实验室稳定性测试
输入使用方波激励，可以测试时域或者频域得到相位裕度：
测试的前提：
- 用1X探头，信号没有衰减，噪声小。可以打开20Mhz带宽抑制。
- 测试的f 小于闭环带宽
- 保证运放的直流工作点正常

测试的分析方法：
- 从频域分析:相位裕度
	- f0位置为-3db时，有68°裕度
	- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598261663_20200819150509038_1366894109.png  )
- 从时域分析：相位裕度
	- 过冲20%，有48°的相位裕度
	- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598261665_20200819150602802_1756718004.png  )
## 2.4. 输入电阻
输入电阻分析：
1. 直接把+/-输入当做断路
2. 如果信号点电平不变，那么也可以当做接地。

+/-输入电阻匹配，可以有效减少Ib引起的Vos，但是不能减少Ios引起的Vos。但是还是要匹配吧。

## 2.5. 滤波电容Cf
在反馈网络里看是个高通，但是对整个反馈回路来说是个低通。因为当f很高的时候，增益最低=0db，所以是个低通
公式：![](https://gitee.com/AndrewChu/markdown/raw/master/1598261659_20200819145220116_201258189.png  )

## 2.6. 差模和共模滤波
并联的差模电容，是共模电容的10倍，可以实现差模的fcm比fdm高20倍，差模信号不会被共模影响
公式：![](https://gitee.com/AndrewChu/markdown/raw/master/1598261659_20200819145401062_259638498.png  )

## 2.7. 功耗测试
运放的功耗主要有两个部分：
- 一部分是Iq。运放工作的静态功耗。这个值会和很多的运放参数有关系。
- 输出的三极管吃掉的压降，这个三极管是工作在线性放大区的
公式：![1598261667_20200819153201626_1939822061](https://gitee.com/AndrewChu/markdown/raw/master/1598271288_20200824201439696_559956075.jpg)


## 2.8. 噪声
en_RMS：电压谱密度。平方根
En_RMS：噪声的有效值，等于一个∂，噪声的Vpp是6.6个∂。
### 2.8.1. 白噪声
也叫broad-nosie，热噪声，宇宙噪声。所有频段，均匀分布。时域上服从高斯分布的噪声。
- 砖墙滤波器补偿系数：
	- 因为要把广谱的白噪声等效到一个砖墙滤波器的截止带宽上。不同阶数的低通，下降速度是不一样的。
	- 系数：![](https://gitee.com/AndrewChu/markdown/raw/master/1598261661_20200819150320800_1265620983.png  )

- 电阻热噪声：
	- 和环境温度，电阻的阻值直接相关。
	- 公式：![](https://gitee.com/AndrewChu/markdown/raw/master/1598261662_20200819150352211_466337746.png  )
- 运放的电压噪声和电流噪声：
	- 这两个噪声也是白噪声。
	- 电流噪声要算2边
### 2.8.2. 闪烁噪声
1/f噪声，主要在低频段。注意fh和fl的取值
公式：![](https://gitee.com/AndrewChu/markdown/raw/master/1598261660_20200819145717192_57465182.png  )

### 2.8.3. 运放的热噪声模型
电阻噪声+运放电压噪声+运放电流噪声。
一般要把电阻噪声控制的低一点。
分析的时候，只要抓住主要噪声。
一般来说，白噪声会比1/f大，只要运放的噪声带宽大于10倍的1/f噪声交点。
图解：![](https://gitee.com/AndrewChu/markdown/raw/master/1598261662_20200819150430256_1570669119.png  )


# 3. ADC
SNR=RMS输入信号/RMS输入噪声。

## 3.1. 非线性
详细的非线性见：TI-高精度实验室-ADC篇

- DNL：差分非线性。一个码的宽度和LSB比
- NMC：不缺码
- INL：积分非线性。所有码的累积误差和LSB比
- 增益误差：曲线是斜率有误差
- offset误差：归0有误差
	- 不要过分相信调零。一般都是单点调零，但是会受到温漂的影响，调好的又会漂移
## 3.2. ADC的量化误差
- ADC的数据手册上只计算量化误差。
- 量化误差导致的RMS输入噪声：
	- 横坐标，其实是电压，从而就是LSB的倍数。
	- 因为算的是噪声，我们关心的是电压平方的RMS，最后还要等效回来
	- 误差的RMS值：误差先平方，积分，除以x轴，开根号
	- 最终的RMS值：1*LSB/sqrt(12)
	- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598261677_20200819172358740_2147203312.png  )
- 等效的RMS输入信号：
	- worst case：以输入±的正弦波，等效出来的RMS值为准。
	- FSR/2*0.707
- 最终SNR：
	- SNR=信号RMS/噪声RMS：
	- SNR=6.02N+1.76 说明量化误差和ADC位数有关系
	- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598261678_20200819172608230_1730860596.png  )



## 3.3. DC有效位数
- DC噪声，因为电压不动的，所以不要管量化噪声
- 噪声服从高斯分布，u=0，∂=RMS。Vpp=6.6∂。所以可以从时域的Vpp求出RMS
- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598261678_20200819174142841_760554710.png  )

## 3.4. AC有效位数
AC的电平一直在变，所以用类似于量化误差的方式，算成理论上的有效位数。
注意：要把噪声和THD一起算上去
公式：![](https://gitee.com/AndrewChu/markdown/raw/master/1598261679_20200819174507317_820344026.png  )


# 4. DAC
## 4.1. 非线性
和ADC非常的类似
- offset error
	- 测量两点，线性耦合之后，方程和y轴的交点
	- gain error：就是斜率的误差
- zero code error：
	- 当输出为0，实际量得的电压
- full scale error：
	- 满量程的误差
- DNL：差分非线性
	- 一个码和一个LSB之间的误差
- INL：积分非线性
	- DNL的积分，和准确值之间的误差
- 总体误差：
	- 不看DNL，只看INL
	- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598261681_20200819182041397_677031242.png  )

# 5. 保护电路
## 5.1. ESD
### 5.1.1. TVS
- 选用双向的
- 选用Vr大于最大工作电压
	- 确保工作的时候漏电流小
- Vbreak要小于最大电气电压
	- Vbreak是漏电流1ma的电压，
	- 这个时候还不能完全保护器件，所以
- Vc：
	- 要小于最大电气电压
- 如果想要限制电流：
	- 要知道最大输入电压，和最大耐受电流。
	- 然后串联一个电阻。
	- 如果要长时间耐受过流，使用PTC电阻
- TVS的选型：
	- 吸收功耗，电流能力
- TVS的容抗，决定了是否能用在高速总线上。还有压电效应，会引起THD

# 6. PCB寄生参数
## 6.1. 微带线
微带线的阻抗，不用背，一般来说有计算器。
公式：![](https://gitee.com/AndrewChu/markdown/raw/master/1598261670_20200819155209063_865303622.png  )
## 6.2. 相邻线
公式：![](https://gitee.com/AndrewChu/markdown/raw/master/1598261669_20200819155151554_634061948.png  )

## 6.3. 过孔
公式：![](https://gitee.com/AndrewChu/markdown/raw/master/1598261668_20200819155125054_1640134120.png  )

# 7. BUS
## 7.1. SPI
- 建立时间和保持时间
	- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598261672_20200819163539122_398717470.png  )
- SPI的4种模式
	- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598261673_20200819163611961_1095539650.png  )、


## 7.2. IIC
- IIC的时序
	- 建立+MSB+LSB+ACK+stop
	- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598261674_20200819163657847_210108172.png  )
- IIC的数据信号SDA只能在SCK的低电平变化。因为这个高电平都要采样
	- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598261675_20200819163759520_824931136.png  )
	- 如果SDA在SCK的高电平变化了，就会被理解为开始位或者结束位。
- IIC的上升和下降时间
	- 上升时间：电源给RC充电
	- 下降时间：没限制
	- 器件工作电流：如果电阻太小，流入器件的电流就会很大
	- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598261676_20200819163923672_463177720.png  )

# 8. multiplexer
- 工作原理：2个管子一起工作，但是电阻是不一样的。
	- +input，PMOS导通的多一点
	- -input，NMOS导通的多一点
	- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598261681_20200819182905671_1495722488.png  )
- 寄生电阻：因为Vgs的电压差会变化，可变电阻区的R在变化
	- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598261682_20200819182925802_164284034.png  )
- 寄生电容
	- S和D都有电容
	- 所以on和off的电容不一样
- 漏电流：
	- 如果后端阻抗无穷大，那电压就会很大
- 带宽
	- 后端电容，和内部的一个电容，导通电阻决定。上GHZ
- 频道间crosstalk：
	- 随着f，耦合会更加厉害
- off isolation：
	- off时候的输出。
	- 随着f，耦合会更加厉害	



















































