# 1. TI-高精度运放

## 1.1. 参考资料
1. [TI-precision-labs](https://training.ti.com/ti-precision-labs-amplifiers?context=1139747-1139745)

## 1.2. 总结
1. 理解运放的基本工作原理：
	1. 虚短虚断，这个建立在深度负反馈的基础上
1. 了解运放的非理想特性：
	1. Vos
	2. IB
	3. Ios
	4. SR
	5. GBW
	6. PSRR
	7. CMRR
	8. rail to tail
	9. 输入信号失真，输出信号失真
1. 会用MF法分析运放的电路：
	1. M：前馈系数。把Vout置为0，V+-V-/Vin
	2. F：反馈系数。把Vin置为0，V--V+/Vout
		1. F就是ß，就是运放的噪声放大系数。
		2. 理解了这个，后面的运放噪声放大，运放的环路增益就会很好理解。
1. 理解Cf的作用：反馈回路的高通，等于整个运放的低通。可以用来调节相位裕度
2. 会画bode图，会使用仿真工具绘制伯德图
	1. 一个极点的幅频和相频
	2. 零点的幅频和相频
1. 理解环路稳定性的原理和判据，会使用仿真工具分析环路稳定性
	1. 不能让分母为0
	2. 相位裕度
	3. 幅频裕度
1. 会理论分析环路增益，会实验室测量环路增益
2. 理解增益带宽积
3. 理解摆率对输出的限制，理解全功率带宽对输出的限制，理解增益带宽积对输出的限制。
4. 理解Iq为什么会对各个参数产生影响
5. 运放的功耗计算
6. 理解MOSFET和BJT运放的不同点
	1. MOS：电压噪声大
	2. BJT：I但是电压噪声小，电流噪声大，Ib也大
4. **噪声分析**
	1. 电阻噪声
	2. 运放的电压噪声和电流噪声。
	2. 运放的白噪声和1/f噪声
	3. 示波器的噪声测量，底噪，白噪声和1/f噪声
	4. 理解噪声Vpp和RMS和∂的关系
1. 理解THD的来源：非线性失真，会导致频谱变化，产生高次谐波
	1. 线性失真：可以通过放大缩小，平移得到原来的波形
1. 理解OPA设计时候的**容差**：
	1. 蒙特卡洛分析：
	2. 因为之前说的非线性参数。选定关键参数，选一个好的器件
	2. 因为温度对这些非线性参数的影响。温漂很难校准
	3. 因为老化的影响。定时校准
	4. 因为器件本身的噪声。选一个好的器件最重要
	5. 电路的合理性。如果电路要求很多电阻都要匹配，那么这个电路实际价值就不高
	6. 尽量选用高容差的器件，电阻高精度，低PPM
	7. 加入自校准电阻，一般都是一个点的0点校准。
1. 偏差的组成：
	1. 和所有的传感器一样，OPA和ADC都有：
	2. offset error
	3. Gain error
	4. Temp drift
	5. 调零能解决一部分，做个基于温度的软件校准也能有作用
1. 这个系列里没有提运放的特征频率，截止频率，低通滤波器的概念
	1. 特征频率：让分母实部为0，相位位于正中间
	2. 截止频率：让增益下降-3db
	3. 低通滤波器：
		1. 电路结构来分：
			1. SK
			2. MFB
		1. 按照bode plot 来分：
			1. 巴特沃斯：f0=-3db
			2. 切比雪夫：最窄，但是通带起伏
			3. xxx:最平缓。


## 1.3. 名词解释
OPA：operational amplifier  
SNR：signal noise ratio  
THD：total harmonic distortion  
SW：slew rate  
PSRR：power supply ripple rejection  
CMRR：common mode ripple rejection  
Vos： voltage offset  
Aol：gain open loop  
GBW：gain bandwidth  


# 2. 基础

## 2.1. 非线性
- Vos：input offset voltage
	- 定义：指的是25°下的偏移电压，温度变化，还会影响这个值
	- 产生原因：BJT的不对称性
	- 分析方式：在+端串联一个电压源，后端才是理想运放
	- 怎么避免：
		- 选用小的IC
		- 出场校准的IC
- Ib：input bias current：
	- 原因：BJT的驱动电路，或者MOS的二极管漏电流
	- 怎么避免：
		- 选用MOS的，会小很多
		- 外部电阻小一点，会改善
		- 阻抗匹配可以消除Ib，但是对Ios没有效果
- Ios：input offset current：
	- 原因：BJT的不对称性
- Iq：静态电流越大，那么
	- BW越大
	- slew rate越大：给电容充电越快。
	- 噪声越小:看运放的噪声曲线
	- 功耗越大：P=VCC*Iq
- 输入输出限制：输入和输出的电压，都会受到rail的影响
	- 输入限制：
		- 定义：一般规定的是输入的共模电压的上下限。这里的共模电压值就是指输入这个通道的电压值，因为虚短。
		- 原因：BJT有压降，电流源有压降。
		- 轨到轨：
			- 方法1：有两队PN-MOS换用，超过阈值了，就会切性能好的。
				- 缺点：
					- 因为Vos不一致，所以导致输出会有交越失真
				- 改善：
					- 使用有Vos校准的轨到轨运放，就是Vos有很小的变化，也不会有大的失真
			- 方法2：利用PMOS和电荷泵抬升电源，没有Vos的切换，没有交越失真，但是有开关噪声
	- 输出限制：
		- 定义：输出也不一定能到rail
		- 注意：要看标注的Aol，如果有，那就是在这个输出下还是线性输出。如果没有，这个时候已经是非线性了。
		- 轨到轨：
			- 用了反向的图腾柱，三极管不是跟随器，而是放大区，压降就是Vcesat。注意，这样的话要注意驱动电路，不要直通了。
			- 输出有小量的漏电流
			- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278457_20200813194232177_998791972.png )
			- 输出电流保护电路：
				- 使用采样电阻，控制一个三极管的Vce，超过0.7就把输出管的Ib拉走。
				- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278458_20200813194300153_1964488452.png )
## 2.2. 热阻计算
J：junction 结温度  
C：case 外壳温度  
热阻定义：![](https://gitee.com/AndrewChu/markdown/raw/master/1598278459_20200813194334662_1743823786.png )
贴了散热器的热阻计算就会很麻烦。包括导热硅脂的热阻。

# 3. 运放的基本特性

## 3.1. blode图
相频在识别运放的零极点有重要的作用：
- 一个极点-90 一个零点+90。
- 转折频率处，对应着45°的变化
- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278463_20200813210059333_837452457.png )

零点+极点的电路：可以调节相位裕度。
- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278464_20200813210231424_455622361.png )

## 3.2. Aol和环路增益和反馈系数
ß=F，是反馈系数。1/ß是反馈增益
一定要理解ß的意义。要从MF框图去理解。
- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278465_20200813210313206_1865819772.png )
- 注意：这个是环路增益，不是完全的闭环增益。要用这个分析环路的稳定性。
- 也要掌握实验室测量环路增益的方式

### 3.2.1. 增益带宽积
注意，当Aol=1/ß后，运放就不能等效成虚短虚断了，因为不在深度负反馈了。  
注意：算增益带宽积，要使用噪声系数，也就是反馈系数。因为有没有M是不会干扰到运放的开环特性的。  
图：![](https://gitee.com/AndrewChu/markdown/raw/master/1598278466_20200813210432209_1276694510.png )
图：![](https://gitee.com/AndrewChu/markdown/raw/master/1598278468_20200813210531174_2104369553.png )

## 3.3. 压摆率
- SW：slew rate 摆率
	- 摆率和静态工作电流Iq有关系。静态工作电流会影响功耗
	- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278475_20200815101127631_2139603944.png )


## 3.4. 体效应
- 体效应：会影响同向放大的摆率。因为共模电压变化了，影响了体电容的大小。
	- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278476_20200815102125885_385542895.png )
## 3.5. settling time
- slew rate+稳定时间
- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278476_20200815102214070_861273266.png )

## 3.6. 信号失真的原因
可能是大信号，也可能是小信号。
```
- 大信号—slew rate
	- 电压驱动能力不够。
	- SR大的Iq的也会很大
- 小信号—增益带宽积
	- 这个时候电压驱动能力以及不是瓶颈了。
	- 但是信号的带宽和上升时间是有关系的：`f=0.35/Tr`
	- 意味着，f是截止频率，在这个频率之内的信号才能体现在时域上。再高的信号，就要被衰减了
```

### 3.6.1. 全功率带宽
突破了SR的限制，接下来要突破带宽的限制
一个信号Vsin(2pi*f*t)，他的变化率2pi*f*V*cos(2pi*f*t)<SR
注意：所以全功率带宽是SR决定的，和GBW没有关系。

同时增益带宽积也会带来限制
fc=GBP/Auf，只有在fc以内的信号，才能被完整的放大。信号的上升时间反应了f。
图：![](https://gitee.com/AndrewChu/markdown/raw/master/1598278475_20200815101506684_709817793.png )
图：![](https://gitee.com/AndrewChu/markdown/raw/master/1598278467_20200813210506943_1895512393.png )


## 3.7. PSRR CMRR
- 各种偏差offset都算成是输入的；再以∂Vos/∂V算增益  
- 电源输入的纹波，可以折算成输入的Vos
	- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278478_20200817070105927_1057493863.png )
### 3.7.1. CMRR:
- 共模电压的变化，可以折算成输入信号的Vos
- DC测试：都算成是Vos的变化量
	- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278479_20200817070151945_724692869.png )
- AC测试：注意，小于20mv的都算小信号。在AC测试的时候，会减去20mv以内的直流信号
	- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278479_20200817070312382_1533287146.png )
- CMRR失真：因为CMRR分成了三段，所以最好Vcm最好不要动。会跳变导致THD很差
	- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278480_20200817070349297_153298822.png )	
	- 这个时候，使用反向放大，因为Vcm稳定，就很有优势
	- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278480_20200817070447872_1660408601.png )
### 3.7.2. PSRR:
- 定义PSRR是在两边输入对称的时候，一起变化了∂，最终看输入的∂Vos
- 主要PSRR是谁除以谁。主要的是，**信号f越高，PSRR的抑制越来越小**，导致纹波越来越大。
- 但实际上，变化是非对称的。意味着会有Vcm的变化，但是这个影响很小
- AC和DC参数：
	- DC：就是跳变一个电平，可以折算成多少Vos。是大信号分析
		- ![1598278481_20200817072052942_2084847889](https://gitee.com/AndrewChu/markdown/raw/master/1598279246_20200824221640285_1385867854.jpg)	- AC PSRR：PSRR的频谱图
		- AC情参数，频率也会影响这个值，
		- 是小信号分析。
	- ![1598278482_20200817072137624_1695285971](https://gitee.com/AndrewChu/markdown/raw/master/1598279247_20200824221739391_677366789.jpg)

# 4. 运放的噪声分析
详细的见截图：
- 名词：
	- 噪声电压密度函数：e   单位v/sqrt(hz)
	- RMS噪声电压：E
	- 闭环带宽：fc=GBP/Auf
	- 噪声带宽补偿系数：k，和运放的极点数量有关系
	- 噪声带宽：BWn=fc*k
	- 1/f和white noise的交点：ff
- 降低噪声：
	- 选对运放：当反馈电阻很大的时候，选择CMOS类型的运放
	- 多级运放：放大倍数都放在第一极，那就可以减少噪声被放大
	- 零偏移运放，没有1/f噪声，e是平的曲线。所以长时间工作的噪声是不会变的
- 噪声分析的技巧：
	- 可以只关注主要噪声，放弃次要噪声
	- 仿真不会告诉你哪些噪声是主要噪声
	- 低噪声和低功耗是矛盾的：典型的就是电阻噪声，噪声低了，功耗就上升了
	- 当BW>10ff时：white noise强
		- 因为ff基本小于1khz，所以运放的带宽大于10khz，那就白噪声强于1/f闪烁噪声
	- 噪声的值：就是E的值，算出来是RMS，根据数学RMS=∂，Vpp=6.6∂
		- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278495_20200817132718213_813210525.png )

- 噪声增益和1/ß是一样的，都是同向放大+1
## 4.1. 噪声模型
运放的基础噪声模型：电阻噪声+运放的电压和电流噪声
图：![1598278485_20200817083035962_775418019](https://gitee.com/AndrewChu/markdown/raw/master/1598279248_20200824221839261_1342056596.jpg)
图：![1598278494_20200817085431247_1597319160](https://gitee.com/AndrewChu/markdown/raw/master/1598279249_20200824221932253_1067169785.jpg)

## 4.2. 噪声的分类
1. 白噪声，服从高斯分布。±∂是68.3%  ±3∂是99.7%
	1. 特征：全带宽，服从高斯分布
	2.  ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278485_20200817083108894_1519875337.png )


2. 粉红噪声,1/f噪声
	1. 特征：主要集中在低频段。f越大，噪声越小
	1. ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278486_20200817083227418_226807894.png )

3. 爆米花噪声，是半导体内部的缺陷，无法数学建模，所以不分析
	4. ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278487_20200817083409224_176801033.png )

4. 其他称呼：
	1. ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278488_20200817083451254_1525077830.png )

## 4.3. 概率论基础
概率分布函数：可以看到每一个点发生的概率的大小。注意，对应的值不是P  
概率：对概率分布函数的积分。  
高斯分布的概率分布函数：±∂是68.3%  ±3∂是99.7%   
高斯分布：![1598278489_20200817083803697_1765761865](https://gitee.com/AndrewChu/markdown/raw/master/1598279251_20200824222507126_867351204.jpg)

噪声的叠加：  
不同源的噪声，可以用平方根叠加。

功率密度谱：噪声密度谱是W/Hz,那么噪声电压密度函数就是V/sqrt(Hz)  
图：![](https://gitee.com/AndrewChu/markdown/raw/master/1598278490_20200817085109262_235476115.png )


RMS均方根值和∂标注差的关系：  
理论上是没有关系的，但是u=0的高斯分布，RMS=∂，这个只是计算公式上的一致  
公式：![1598278490_20200817084052743_1083147162](https://gitee.com/AndrewChu/markdown/raw/master/1598279253_20200824222713020_1483513401.jpg)

电阻的热噪声：和温度，阻值有关系。类似于白噪声，但是不是。  
如果组值固定，温度固定，那就是白噪声了。  
图：![](https://gitee.com/AndrewChu/markdown/raw/master/1598278492_20200817085315330_1982187031.png )
图：![](https://gitee.com/AndrewChu/markdown/raw/master/1598278492_20200817085415013_703614106.png )

## 4.4. 运放类型和噪声的关系
- 电压噪声：
	- Bipolar的比CMOS的小
	- 静态电流大的，电压噪声小
- 电流噪声：
	- 和Ib有关系，偏置电流大的，电流噪声大
	- CMOS的Ib都小，所以电流噪声小
- 如果长时间测量，温漂带来的波动就像是1/f噪声。所以要选择一个零漂移的运放
- 1/f噪声，长时间测量，会把误差累积上去，就像0hz永远不可能被测试到
## 4.5. 噪声的计算公式
1/f噪声
图：![](https://gitee.com/AndrewChu/markdown/raw/master/1598278495_20200817133741832_1621386925.png )

白噪声
图：![555](https://gitee.com/AndrewChu/markdown/raw/master/1598278496_20200817133818631_1230051692.png )

## 4.6. 噪声测试
### 4.6.1. 示波器
- 不要使用探头衰减
- 使用BNC接头的，1：1探头。不要用地夹子，这个是个天线。外壳也要用电磁屏蔽
- 测试底噪要用BNC短接帽子
- 用20M带宽抑制
- 1/f噪声要用DC耦合。白噪声要用AC耦合，防止工频干扰
- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278498_20200817142018454_1801201422.png )

### 4.6.2. 频谱分析仪
用一个带通滤波器，慢慢的去采样，也可以做平均
bandwidth越小，波形越精细，但是时间越慢
- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278498_20200817142629876_1862811442.png )
- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278499_20200817142817098_107816081.png )


# 5. THD+N
奇次谢波：输入差分失真
偶次谐波：输出大信号失真
- THD+N：总谐波失真+噪声
	- 针对输出，噪声是恒定的。注意乘以G
	- 总谐波失真，总是越来越大的。在高频段才会出来。
		- 是因为波形失真了。因为输入输出的交越失真，early效应，共模差模都会导致
- 内外的失真源
	- ![1598278500_20200817205322186_514208606](https://gitee.com/AndrewChu/markdown/raw/master/1598279252_20200824222617562_1106710988.jpg)
- 长尾电流和差分电压
	- 决定了静态工作电流和SR
	- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278500_20200817205736835_829845514.png )
	- 差分电压看似是线性控制Io，但是实际上是失真的。因此我们引入了差模输入失真。
		- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278501_20200817205858169_1454750180.png )
		- 越大的Aol，Vcm引起的失真就会越小
	- 摆率也会导致失真
		- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278502_20200817211819867_884954165.png )
		- 要搞清楚是全功率带宽，还是SR。
			- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278504_20200817211910892_2100395680.png )
	- 输入有两队NP MOS，共模电压一切换Vos都会变，那失真就不一样了
	- 输出失真：推挽和轨到轨。多多少少都会有非线性
	- 输出负载：
		- 负载效应：电阻越小，电流越大，失真越大
	- 输出电流
	- 短路保护失真：短路保护电路不是线性的
	- 热失真：要热对称
	- 电源失真
	- 电容失真：因为电压不一样，容量不一样
	- esd失真：有电容，加的电压不一样，电容不一致。还有漏电流
	- 电阻失真：压电效应，大信号，小封装比较明显



# 6. 运放的稳定性 
为什么接近180°相移的时候不稳定
公式：![](https://gitee.com/AndrewChu/markdown/raw/master/1598278469_20200813210544749_1230894828.png )
## 6.1. 基本概念
运放稳定性：
- 不稳定的原因：
    - Vo和Vfb之间有了延时模块
        - 运放的输出接了大电容。会引入新的极点，导致相位裕度不够
        - 运放输入的寄生电容
        - ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278459_20200813205819339_1960963449.png )
        - ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278460_20200813205830507_481156834.png )
- 特征点：
    - 幅频-3db：
        - 是原始信号的0.707
        - 相位是45度
    - 相频fc/10: 0度
    - 相频fc*10: 90度
- 极点：1/(1+s/w0)
    - 对应的低通
    - 幅频向下，20db
    - 相频从0到-90
- 零点：1+s/w0
    - 对应的高通
    - 幅频向上，20db
    - 相频从0到+90
- 零点+极点：(1+s/w0)/(1+s/w1)
    - 零点先起作用，然后再极点。看w0和w1的大小
    - 幅频：从0db开始，向上，然后平。
        - 因为先零点，然后再极点补偿了斜率
    - 相频：从0开始，到90，然后再到0

- 开环增益和环路增益
    - 直接把1/ß画到开环增益曲线上，就得到了环路增益曲线
    - 交点就是fc。因为Auf=Auo/(1+ Auo*ß)
- 增益带宽积
    - 直接把GBW/Auf，就得到了fc，虽然有点误差。
    - GBW大和静态电流小相互矛盾
    - 反向放大的增益，要+1，按照同向来计算。
        - 因为是计算ß和GBW的关系。
        - 负反馈的增益包含了M/F，要把M的影响丢了
- Gain Peaking
    - 因为运放的第二极点，接近了单位增益0db，就会导致闭环增益会有一个Q值，波形上会有个凸起
- 带宽的限制：
    - 增益带宽积
    - 运放的共模差模电容
- 直接限制带宽
    - 回授电容滤波器：
        - 针对高增益的效果好，因为降为0db
        - 截止频率就是Rf和Cf决定
- 全功率带宽：
    - 因为SR会限制运放的输出，
    - 如果f太，那么输出的SR会超过限定值。那么就会失真


## 6.2. 理论分析
- 1/ß 和Aol曲线
- 闭合速率判断稳定性
- ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278470_20200813210636699_939402645.png )
## 6.3. 稳定性实验室判断
- 实验室Aol曲线仿真测试
    - 交流环路和直流环路
    - ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278471_20200813210716696_240481771.png )
    - ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278471_20200813210802858_212901543.png )
- 实验室测试
    - 过冲分析法：
        - 输入一个阶跃，1mv
        - ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278461_20200813205939767_1526978083.png )
        - 输出10mv以内，满足小信号
        - 分析过冲，直接和相位裕度相关。从欠阻尼的数学公式上
            - 相位稳定：最大22%的过冲
    - 交流增益分析法：
        - 相位稳定：交流增益最大2db
        - ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278472_20200813210850345_528477299.png )
        - ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278461_20200813205952974_1491059331.png )
        - ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278472_20200813210907289_125600301.png )
        - ![1598278477_20200816202341867_1971522039](https://gitee.com/AndrewChu/markdown/raw/master/1598279251_20200824222351444_1294188056.jpg)

## 6.4. 稳定性补偿
- 容性输出的补偿
    - 加入Riso电阻
        - 原理：因为输出电容增加了一个极点，加入Riso之后，可以增加一个零点抵消相位的衰减。
	        - 类似于欠阻尼，增加了电阻的阻尼
	        - ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278473_20200813210923518_2135317553.png )
        - 在Aol是20db的时候，加入这两个零极点
        - 优点：
            - 简单
        - 缺点：
            - 当后端负载很小的时候，这个电阻会分压。
    - Riso+双反馈
        - ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278462_20200813210029121_1247499274.png )
        - ![](https://gitee.com/AndrewChu/markdown/raw/master/1598278473_20200813211033547_1682888254.png )
        - 缺点：
            - 收到Cload变化的时候，稳定性变差
            - 建立时间变得更加慢


## 6.5. 多反馈分析
要把输入电容补偿回去
图：![](https://gitee.com/AndrewChu/markdown/raw/master/1598278474_20200813211115374_1943253988.png )

# 7. 容差分析：
容差？容许的误差。
OPA的容差分析，关注在非线性的参数。
- 电阻：
	- 本身有精度1%。1%的
	- 温漂 100PPM的
	- 如果是差分运放，要求4个电阻匹配的很好。不然就会差模转共模了。只能依靠集成了高精度电阻的IC来实现
	- 在设计的时候，就尽量减少对电阻匹配的需求。如电流源，两个匹配电阻，可以换成只要1个匹配电阻的结构
	- 可以用蒙特卡洛分析，来得到一群电阻有误差的时候的最差值
		- 就是所有的参数都扫描一遍
		- LTspice推荐使用-1 0 1这三种情况来简单计算一下worst case
	- 如果误差是级联的，那么误差不是简单的相加。而是服从高斯分布的，新的标准差是旧的均方根
- 运放：
	- 就是他的一堆非线性参数。如Vos Ib Ios
	- 分析常温下的很简单，最麻烦的这些参数都会有温漂。所以case by case。如果需要长时间温度的，那就要选温漂小的，加定时校准。
       - Aol不是无穷大，导致Auf也有误差。
       - 想要运放的误差小，就要选个误差小的运放。有低Vos的，低Ib的
- 最大误差和统计误差
    - 最大误差：就是把误差直接相加
    - 统计误差：多个独立的高斯分布函数相加，新的函数也是一个高斯分布。新的∂是∂的均方根值。一般取3个∂
    - 把这两个误差，都当成是线性方程。最终拟合也用线性方程。
        - 测试两个点，可以得到斜率和截距
            - 0V校准：现实中成本，太大。可以简单地默认斜率不变，输入短接测试截距。
                - 注意，要用双极性的ADC或者差分输入的，只要能测到负电压就行
   
- 无法校准的误差：
   - 温漂
   - 老化
   - 温度迟滞

- 降低噪声
    - 低噪声的器件
    - 降低电阻
    - 降低带宽
    - 数字平均：针对多个独立的高斯分布
        - 噪声降低到原来的sqrt(N)

## 7.1. 误差校准：
基本原理：![](https://gitee.com/AndrewChu/markdown/raw/master/1598284547_20200820084918269_234650911.png )
# 8. INA
INA：**带宽低，不适合直接驱动ADC，适合驱动高阻抗的PGA**
- 如果驱动ADC，要接一个缓冲器？为什么呢？
INA:二运放的缺点。两个端有延时，CMRR会低一点，因为不对称性
INA：**即使满足了输入电压，运放里都有可能会满量程**。输入共模电压和输出电压是有关系的，同时也和Vref，供电电压有关系。有一个星型图可以参考
**REF脚内部连了电阻，所以要控制这个脚，要用电压跟随器**


# 9. FDA
- FDA
    - 优点
      - 低失真
      - 输出的范围*2
      - 单端转差分，适合ADC
  - Vocm
      - 可以设置输出的共模电压
      - 内部是个误差放大器，输出控制了FDA的Vcm
  - 失真：
      - 他本身的传递函数是非线性的
      - 差分的结构，可以抵消偶次谐波：反馈电阻要完全匹配
          - 0.1% 20ppm的金属膜电阻

# 10. 其他总结的资料
[运放参数](https://gitee.com/AndrewChu/hardware-design/raw/master/PDF/陈苍-运放.pdf)
# 11. FAQ
## 11.1. 三角波的傅里叶级数
三角波的傅里叶级数
公式：![下载](https://gitee.com/AndrewChu/markdown/raw/master/1598279250_20200824222252191_1629053753.jpg)
PSRR对高频的抑制小，相当于高通。所以把三角波的高频分量放大了，就相当于方波
公式：![下载 (1)](https://gitee.com/AndrewChu/markdown/raw/master/1598279249_20200824222226908_2085251016.jpg)

## 11.2. 肖特基二极管
漏电流大，反向恢复时间快，压降低0.3

## 11.3. TVS和稳压二极管
更快，容量更大

## 11.4. 运放的输入电流
10ma，经过保护二极管的


## 11.5. 什么是体效应
指的是MOSFET的共模电压变化后，导致沟道变化，导致体二极管变化，导致体电容变化，最终影响到SR

## 11.6. 运放设计的难点
- OPA的难点：
	- 低功耗P
	- 低噪声SNR：和低功耗是违背的
	- 低失真THD
	- 低漂移稳定性

## 11.7. 小信号模型和大信号
- 小信号：
	- 不会改变电路的直流工作点。就是叠加一个AC上去，看输出的响应
	- 交流参数扫描，AC扫描，就是基于这个原理
- 大信号：
	- 叠加的信号，会影响电路的工作点。如测量OPA的PSRR CMRR可以叠加很大的信号上去。当然这两个参数也可以使用AC扫描来做


