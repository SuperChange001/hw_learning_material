# 1. Loop Compensation
这部分，水平非常有限，请谨慎参考。    
我已经买了一本很专业的DCDC的书，里面有详细的DCDC的传函的推导过程。主要分为：输出，误差放大，三角波比较。三个阶段的传函。要是电流模式，还会有斜率补偿的因素。等我看完了再更新吧
## 1.1. 参考资料

- [什么是环路补偿](http://murata.eetrend.com/article/2018-07/1001787.html)
- [开关电源TL431环路补偿传递函数推导](https://zhuanlan.zhihu.com/p/109746427)
- [考量运算放大器在Type-2补偿器中的动态响应](https://www.ednchina.com/news/201704type2-2.html)
- [開關轉換器之回授控制‒OTA Type II/III之相位提升](https://www.richtek.com/Design%20Support/Technical%20Document/AN052?sc_lang=zh-TW)
- [Fixed Frequency vs Constant On-Time Control of DC/DC Converters](https://training.ti.com/large-signal-transient-response-comparison?context=1127559-1127554)

## 1.2. 名词解释


## 1.3. 总结
1. 环路补偿是在设计DCDC的最后一个环节。当所有的输入输出参数，元件都定下了，改变补偿网络可以增强电路的稳定性和瞬态响应。当然环路补偿是比较复杂的，还涉及到电路的建模提取，自动控制原理。实际上很多公司不仅在设计的时候不考虑这个，实验室测试的时候也不会测电路的稳定性。当然这个一部分是因为没有网络分析仪，另一部分也是因为DCDC内部或者典型设计都已经补偿好了，所以比较少遇到稳定性的问题。最终导致了硬件工程师的基础越来越薄弱，只能做最基础的工作。这个也是我一直在自我反思的地方。
	1. 设计阶段：
		1. 使用spice工具进行电路仿真，直接画出bode图。问题在于很多IC不提供spice模型，我们对于板子的分布参数的建模也是很困难的
		2. 使用LTpowerCAD。这个是ADI收购了Linear之后，推荐的电力设计的工具，里面可以一键帮你进行环路补偿，功耗分析。
		3. TI的WEBENCH也是类似于LTpowerCAD的工具，也可以环路稳定性分析。
	1. 实验室测量：
		1. 类似运放，我们可以在环路里注入AC小信号，使用网分来绘制bode图。信号一般都是加载在反馈电阻上。
		2. 使用示波器，那就要像运放测试，输入一个阶跃，查看输出的overshoot来判断相位裕度。但是DCDC里面一般有上电启动机制，所以这个方法不可行。
		3. 从load transient来判断。因为环路稳定性就是影响到了这个，如果暂态响应不好，输出会震荡很久。那就说明电路不稳定。响应的快不快是受到电感值和电路带宽的影响。
		
2. 为什么要环路补偿：
	1. 因为不想负反馈变成正反馈。所以有幅频裕度，相位裕度。
	2. 什么时候会变成正反馈？在高频噪声的干扰下。因为对特性的f会产生正反馈，所以即使是很小的噪声信号，最后也会被放大成很大的干扰。
	2. 变成正反馈会怎么样？开关的PWM的D会跳动。因为跳动，电感电容会发声。输出波形的不稳定。
2. 我们想要把环路的伯德图补偿成什么样子？
	1. 满足幅频裕度，相位裕度是基础
	2. 首先DC增益要大，那就直流信号的调整会又快，误差有效
	3. 带宽要大，那就瞬态响应也会好。
	4. 以-1的速度，穿过0db。
3. 会手动推导二型和三型的补偿方式的传函
	1. 关注的是**小信号的传递函数**
	1. 注意，要会使用叠加定理。因为电压不变点，如Vref，对环路的增益的动态响应是没有影响的，可以直接接GND。类似于我们分析运放的放大倍数，也会使用叠加定理把Vref接GND，可以大大减少推导的复杂度。
2. 电压模式DCDC：
	1. 输出的LC有两个极点。
	2. 所以需要用三型补偿，最高180°相位提升。三个极点，两个零点
3. 电流模式DCDC：
	1. 因为L被等效成了一个电流源。所以输出只有一个极点
	2. 可以使用二型补偿。两个极点，一个零点


## 1.4. 一阶补偿
- 就是一个积分环节。
- ![05_2](https://gitee.com/AndrewChu/markdown/raw/master/1599110111_20200903130915453_739996788.jpg)


## 1.5. 二阶补偿

- ![06_0](https://gitee.com/AndrewChu/markdown/raw/master/1599110112_20200903130953972_943021776.jpg)

## 1.6. 三阶补偿
- ![Screenshot-2020-09-03 PM12](https://gitee.com/AndrewChu/markdown/raw/master/1599110115_20200903131329108_1532112707.jpg)
- ![20190912234138425](https://gitee.com/AndrewChu/markdown/raw/master/1599110113_20200903131052829_2072105458.png)
- 这张图的公式有很大的省略：
- ![07](https://gitee.com/AndrewChu/markdown/raw/master/1599110112_20200903131015620_2081095141.jpg)
- ![20190912234628731](https://gitee.com/AndrewChu/markdown/raw/master/1599110114_20200903131106400_1440960037.png)