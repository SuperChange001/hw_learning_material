# 1. Signal Integrity
这个是哪门子的SI？写的一点都不专业!这个是我对这篇文章的评价，要是你和我想的一样，那就英雄所见略同了，哈哈。另外说一点，这篇文章是我一个字一个字码出来~~如果图裂了，请点击[链接](https://github.com/SuperChange001/hw_learning_material/blob/master/SI_notes.md)
## 1.1. 名词缩写
- GPD：groud potential difference
## 1.2. 参考资料
- [所有笔记的链接](https://github.com/SuperChange001/hw_learning_material)    
- 电磁兼容的印制电路板设计（写的很好，但是翻译错误很多，要注意）
- PCB电流与信号完整性设计
- TI-PrecisionLABs-EMC

## 1.3. 总结
1. SI研究的对象总结：
	1. 对自己：反射
	2. 对别人：串扰
	3. 对地平面：信号回流路径
	4. 对空间：EMI
2. layout总结：
	1. 确定叠层，差分和单端信号阻抗控制
	2. 电路功能分区。模拟，低速数字，高速数字，接口IO
	3. 接地方式：不同地之间，地和PE之间。单点还是多点。接地方式，电阻，电容，TVS，还是磁珠。
	2. 3W和10H
	3. 相邻层，走线垂直
	4. 高速信号：
		1. 走内层，避免和其他信号平行走线。最好包地，包地要在1/20λ打一个过孔，作为地牢。
		2. 考虑串联端接，适当的时候使用并联端接，要看是否需要考虑传输线特性。
2. 高速信号的定义
	1. 需要考虑传输线效应的信号。哈哈
1. 要理解麦克斯韦方程组，要理解电场，磁场和电磁场。要理解天线在里面的作用
2. 理解感性耦合，容性耦合的差别。
2. 反射和传输线效应
	1. 传输线效应：
		1. 特性阻抗的定义
		2. 什么时候需要考虑传输线特性
	2. 终端电阻不匹配
		1. 终端开路：反射100%
		2. 终端短路：反射-100%
		3. 终端匹配：没有反射。
	2. 并联匹配
		1. 最常见的匹配方式
		2. 高级一点的，就是把匹配电阻分为两个，中间接电容后接gnd。可以同时对共模滤波
	3. 串联匹配
		1. 放在源端，和源端组成线缆的特性阻抗，吸收终端反射回来的信号
		2. 消耗的功耗小
		3. 在高速信号总线上用的多。起码在终端反射未知的情况下，可以有效地让源端吸收掉所有的反射
	1. 交流匹配
		1. 在终端电阻上串联一个电容，可以有效地降低并联匹配的功耗
		2. 同时也保证了对高频信号的匹配
		3. 对低频信号，就相当于没有匹配
	1. 总线的layout建议：
		1. 	避免长的走线桩，推荐菊花链。防止反射干扰。
2. 信号的回流路径：
	1. 回流路径的规划，决定了EMC的性能
	2. 注意：信号的回流，适合信号的正向传输一起的。为什么？因为电磁场相消。电磁场不能突变，所以要在正下方感应出反向的电流，直接把磁场抵消了。就和电感产生电磁场一样。差别在于电感能把电磁场给储存住。
3. 串扰：记住，DC不耦合。只有AC才会耦合。可以分析电场模型和磁场模型得证
	1. 线线串扰公式：`1/(1+(D/H)^2)`. D是线线之间的距离。H是线和地平面的距离
	2. 电磁场耦合
	2. 电场模型
		1. 偶极子天线模型
		2. 两边要有压差
		3. 通过耦合电容传递
	3. 磁场模型
		1. 环形电流天线模型
		2. 电流环路里要有电流
		3. 电流产生磁场，变化的电流产生变化的磁场，变化的磁场产生感应电压（和L有关系，楞次定理）
		4. 通过环路的电感产生感应电压。电流多大未知。
	1. 解决的方式：
		1. 不同层，垂直走线
		2. 同一层，3W原则。减少70%的磁通耦合。
		3. 微带线，可以使用保护地线。对于带状线，保护地线没有作用（因为临近的GND平面就会抑制住RF磁场。）
		3. 和GND参考层靠的越接近
		3. 差分线，阻抗匹配
1. 信号时延：蛇形线补偿
	1. 这个才是真的高速信号里最关心的SI问题
	2. 因为信号不等长导致的信号时延，是最根本导致信号错乱的原因
	3. 因为现在信号的速度越来越快。导致信号触发窗口越来越窄
	2. 哪里长度不一致，就在哪里引入蛇形线。乱加匹配的位置，会导致信号相位延时。
	3. 等长，也会抑制共模发射。要不然就会有一个辐射窗口在。
1. 电容的ESR不是越小越好
	1. 电容的ESR和C组成了一个零点，可以改善环路稳定性
	2. 电容的ESR可以让不同电容的并联反谐振峰变小。虽然同时也让最小衰减变不好了。
	3. 还有一种情况：在长的电源线，因为L很大，输入的C也很大的时候，会产生LC震荡，这个时候就要电解电容有比较大的ESR来作为阻尼电阻，抑制住或者快速衰减掉很大的Q谐振因子。
1. 信号的回流路径分析：
	1. 要有完整的gnd平面在高速信号线下方，作为回流路径
	2. 高速信号线换层：打一个gnd过孔作为参考
	3. 高速信号不得不跨分割：放置一个C，作为回流路径。
2. 导线的非理想性：
	1. 趋肤效应：
		1. 趋肤深度：表示了等效截面积，但是不是物理上有意义的量
		2. f越大，趋肤深度越浅
	2. 介质损耗：
		1. 场在介质里波动传输，会被消耗能量，这个是介质损耗
	1. 传输线损耗
		1. 传输线有R
1. 高频信号的传输路径：考虑分布电容，考虑共模回路，这样就没错了。
	1. 信号永远都是从阻抗最小的地方走。
	2. 注意是阻抗最小，不是电阻最小
	3. 空气的波阻抗是377欧，意味着，你要是不给高频信号一个低阻抗的回路路径，那么人家就从空气回流了。
	4. 一般的来说，线缆和PE之间的分布电容比较大，所以信号很容易从线缆耦合到PE上。直接就辐射出去了。
2. 共模和差模信号
	1. 差模：
		1. 定义：大小相等，方向相反的电流
	1. 共模：
		1. 定义：都是流入，或者都是流出的电流
		2. 来源：
			1. 电路的不对称性，会导致差模变成共模。
			2. 很高的突变电压信号会从电路的寄生电容走。这个就是个电场辐射模型。
	1. 重要概念
		1. 我们关注的共模电流，不是共模电压
		2. 但是共模电压会导致共模电流，关键就是理解两者之间的关系。共模回路的阻抗是不一定的！！！所以很大的共模电压，并不一定会导致很大的共模电流。
		3. 给**共模电流设定回路**。其实从电场辐射的角度，加入一个大的C，会导致电场辐射变大。但是，要理解，环路的长度变小了，就是天线的臂变短了，也可以抑制电场辐射变大。同时对磁场辐射来说，电流的环路是更加显著得变小了，磁场辐射也变小了。

# 2. EMC和天线
1. 要理解麦克斯韦方程组，要理解电场，磁场和电磁场。要理解天线在里面的作用
2. 理解感性耦合，容性耦合的差别。
2. 电场：
	1. 原因：电荷差
	2. 天线：偶极子天线
	3. 辐射方式：当偶极子天线的长度为1/2λ或者倍数的时候最强。当小于1/20λ的时候不发射。通过寄生电容耦合。
	4. 接收方式：当小于1/20λ的时候不发射
3. 磁场：
	1. 原因：电流
	2. 天线：环形电流天线
	3. 辐射方式：环路面积大，I大，L大，发射大。
	4. 接收方式：环路面积大，寄生电感大，接收的就会多。
4. 电磁场：
	1. 是在远场条件下。
	2. 针对30M的信号，3m的电波暗室就已经是远场了

# 3. 感性和容性的串扰
感性和容性的概念非常重要，但是又因为比较抽象，所以难以理解。
1. 感性和容易的干扰，其实就是EMC的电场干扰和磁场干扰的另外一种说法！
	1. 感性：磁场
		1. 形成互感的干扰，就像是个变压器。主要还是通过磁场来传递。那就需要有个交变的电流
	2. 容性：电场
		1. 两边走线有电压差，同时分布电容又比较小的时候。
1. 由于是传输线，所以有向前和向后的串扰。但是向前的串扰会比向后的大很多。因为向前的已经经过了一次的反射。

# 4. 射频电流密度分布
2. 信号的回流路径：
	1. 回流路径的规划，决定了EMC的性能
	2. 注意：信号的回流，适合信号的正向传输一起的。为什么？因为电磁场相消。电磁场不能突变，所以要在正下方感应出反向的电流，直接把磁场抵消了。就和电感产生电磁场一样。差别在于电感可以储存磁场
	3. ![IMG_1016](https://gitee.com/AndrewChu/markdown/raw/master/1599896537_20200912153901416_1461688999.jpg)
1. 回流电路的电流密度分布：
	1. ![IMG_1015](https://gitee.com/AndrewChu/markdown/raw/master/1599892808_20200912144003198_1419124020.jpg)
	2. 上面还解释了为什么需要3W原则，可以减少信号的串扰。
1. 怎么确保信号的回流路径：
	1. 高速信号，最好走在内层，形成带状线。虽然寄生电容大了，影响信号的时延。但是可以确保能量不会辐射出去
	2. 要考虑GND平面，TI不建议参考电源平面。参考平面和走线越近越好
	3. 高速信号换层的时候，肯定需要过孔。在这个过孔边放置gnd过孔，在垂直方向上给回流路径。


# 5. 接地
当信号的f变高到1Mhz以上，就应该让他尽快接PE，因为走线都是有电感的，这个时候还在采用单点接地，那就是一个电压辐射天线。尤其是当走线长度为1/4λ的时候，走线的阻抗最大。
## 5.1. 单点接地还是多点
1. 支持单点接地的理由有两个：
	1. 多点接地会引入GND环路。
		1. 环路会带入辐射干扰，也会有辐射发射。
		2. 辐射干扰：考虑的是磁场环路耦合。多点接地之间的环路要小，而且寄生电感要小。
		3. 辐射发射：如果考虑电场辐射，只要把偶极子天线的长度控制在1/20λ的时候，辐射就会很小。意味着分析一下电路的最大工作频率，算出λ，然后要求接地孔之间的距离小于1/20λ。
		4. ![IMG_1017](https://gitee.com/AndrewChu/markdown/raw/master/1599896545_20200912154210828_82314338.jpg)

	2. 多点接地会带来GPD。
		1. 把接地点之间的阻抗控制住，同时如果产生GPD，使用抗共模强的IC
1. 所以要把以上两个问题处理好了，就可以使用多点接地。但是单点接地的致命问题是对高频信号，会产生电场天线的作用。这个就很难处理了。
2. 所以高频信号，要使用多点接地。

# 6. 端接
端接方式可以有很多种方式。
- 串联：比较常用，但是带来的走线长度变大了
- T型：走线短了。但是要考虑stub的长度，同时也要考虑不同的stub的长度要精确匹配
- ![IMG_1028](https://gitee.com/AndrewChu/markdown/raw/master/1600225019_20200914140158543_1099501476.jpg)




# 7. FAQ

## 7.1. 单位换算
- 1in==25.4mm
- 1 mil== 1in/100

## 7.2. 常用数字器件的上升时间和对应的辐射频率
- 能选慢的器件就选慢的。会利于EMI。辐射能量和f的三次方成正比
- 就和能把线做短就做短，也利于EMI
- ![IMG_1018](https://gitee.com/AndrewChu/markdown/raw/master/1599897174_20200912155113599_1902156977.jpg)

## 7.3. 什么时候需要端接
- 当需要考虑传输线特性的时候
- 当信号的上升时间很快，然后线又很长导致了传播时间很大。同时也和器件的电容有关系。
- 器件电容和走线的分布电容，会影响走线的传输延时变大，在分析的时候，要计算这两个参数来补偿。参考书籍P74
- 很多时候，我们没有那么详细地去分析。如果担心反射，就会在输出信号端接一个小电阻作为匹配，因为做并联匹配还是比较麻烦的
- ![IMG_1026](https://gitee.com/AndrewChu/markdown/raw/master/1600059289_20200914125439351_1871054120.jpg)
- ![IMG_1027](https://gitee.com/AndrewChu/markdown/raw/master/1600059290_20200914125445191_401459963.jpg)

## 7.4. PCB的寄生参数
- PCB的等效电气图和等效原理图
- ![IMG_1020](https://gitee.com/AndrewChu/markdown/raw/master/1600058046_20200914123358676_2029800976.jpg)

## 7.5. PCB走线的速度
- 微带线：55ps/cm
- 带状线：69ps/cm

## 7.6. PCB上升时间和最长传输线长度
- 当PCB的上升时间越来越小，那么包含的信号带宽越来越宽。那么就要考虑传输线效果了
- 1ns----9cm
-   ![IMG_1022](https://gitee.com/AndrewChu/markdown/raw/master/1600058413_20200914124009873_1030888354.jpg)












































